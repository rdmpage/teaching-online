<!DOCTYPE html>
<html>
<head>
<!--	<script src="jquery-1.11.2.min.js"></script> -->
<!--	<script src="treelib.js"></script>
	<script src="midpoint.js"></script> -->
	<script src="phylo.js"></script>
	
	<!--
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
  -->
  <link href="phylotree.css" rel="stylesheet">

  <!-- <script src="//code.jquery.com/jquery.js"></script> -->
  <script src="js/jquery.js"></script>
  <!-- <script src="//netdna.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script> -->
  <!-- <script src="//d3js.org/d3.v3.min.js"></script> -->
  <script src="js/d3.v3.min.js"></script>
  <script src="phylotree.js"></script>
  <!-- <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script> -->
  <script src="js/underscore-min.js"></script>
	
	<style>
	/* http://biomodel.uah.es/en/model4/dna/atgc.htm */
	.A { background-color:#5050ff;color:white;padding:2px; }
	.C { background-color:#e00000;color:white;padding:2px; }
	.G { background-color:#00c000;color:white;padding:2px; }
	.T { background-color:#e6e600;color:black;padding:2px; }
	.N { background-color:#3050F8;color:white;padding:2px; }
	.gap { background-color:#3050F8;color:white;padding:2px; }
	</style>
	
</head>
<body style="padding:20px;">
<a href="index.html">Home</a>
<h1>Build a tree for "flytrap" data</h1>

<div style="position:relative;">

		<!-- enter data -->
		<div style="width:100%;padding-bottom:20px;">
			<p>Sequence</p>
			<textarea id="data" rows="10" cols="100" style="line-height:1.4em;font-size:10px;font-family:monospace;">
>Strepsipte
AAGCTCATTAAATCGCTTTGGTTCCTTAGATAGTTGGATAACTGTGGTAATTCTAGAGCTAATACATGAAACAGTGTGAAAGAATATTTGCACGCTTTTA
TTAGGGAAAAGCCAATAAATGCGGCGTATCTTTCAATTGTCTGCCTTATCAACTGTCGATGGTAGATTACATGTCTACCATGGTTGTAACGGGTAACGGG
GAATCAGGGTTCGATTCCGGAGAGGGAGCCTGAGAAACGGCTACCACATCTAAGGAAGGCAGCAGGCGCGCAAATTACCCACTCCCGGCACGGAGGTAGT
GACGATAAATAACGATCCGGAACTCTTGAGTTTCCGTAATGGAATGAGTACAATTAAATCCGTTAACGAGGAGCAAATGGAGGGCAAGTCTGGTGCCAGC
AGCCGCGGTAATACCAGCTCCATTAGCATATATTAAAGTTGTTGCGTTTAAAAAGCTCGTAGTTGAATCTGATCTCATCATGTCAGTCCATTACTTTGAA
CAAATTAGAGTGCTTAAAGCAGGCCCTGAATAAACAGCATGGAATAATAGAATATGATCTCGAGAGACGATGGGGGCATTCGTACTACGACGCTAGAGGT
GAAATTCTTGGACCGTCGTAAGACGAACTGAAGCGAAAGTTTGTCAAAAACGTTTTCATTGATCAAGAACGAAAGTTAGAGGTTCGAGGCGATCAGATAC
CGCCCTAGTTCTAACCATAAACGATGCCGACCAGCGATCCGTCGATGTTCATTATGACTCGACGGGCAGC
>Aedes
AGGCTCAGTATAACACTATAATTTACAAGATCATTGGATAACTGTGGAAAATCTAGAGCTAATACATGCAATGCAGGAACCTCGCGGAACTGTGCAATTA
TTAGTCAAACCAATCGACCGACGACAGATCTTTCAAATATCTGCCCTATCAACTATTGATGGTAGTATAGAGGACTACCATGGTTGCAACGGGTAACGGG
GAATCAGGGTTCGATTCCGGAGAGGGAGCCTGAGAAATGGCTACCACATCCAAGGAAGGCAGCAGGCGCGTAAATTACCCAATCCCGGCACGGAGGTAGT
GACGAGAAATAACAATATAAGACTCTAGACGTCTTATAATGGAATGAGTTGACATAAATCCTTCAACAAGGATCAAGTGGAGGGCAAGTCTGGTGCCAGC
AGCCGCGGTAATTCCAGCTCCACTAGCGTATATTAAAATTGTTGCGGTTAAAACGTTCGAAGTTTATTCTTGTCCAACACGGGTGCTACATTACCTTGAA
CAAATTAGAGTGCTCTAAGCAGGCCCAGAATAACTTGCATGGAATAATGGAATATGACCTCGAGAAGTATTGGGGGCATTAGTATTACGGCGCGAGAGGT
GAAATTCGTAGACCGTCGTAAGACTAACTAAAGCGAAAATTTGCCATGGATGCTTTCATTAATCAAGAACGAAAGTTAGAGGATCGAGGCGATTAGATAC
CGCCCTAGTTCTAACCGTAAACTATGCCAATTAGCAATTGGGAGACGCTACATATGGTGCTCTCAGTAGC
>Drosophila
AGGCTCATTATATCATTATGGTTCCTTAGATCGTTGGATAACTGTGGTAATTCTAGAGCTAATACATGCAAAACATGAACCTTATGGGAGTGTGCTTTTA
TTAGCTAAACCAAGCGACCGACGACAGATCTTTCAAATGTCTGCCCTATCAACTTTTGATGGTAGTATCTAGGACTACCATGGTTGCAACGGGTAACGGG
GAATCAGGGTTCGATTCCGGAGAGGGAGCCTGAGAAACGGCTACCACATCTAAGGAAGGCAGCAGGCGCGTAAATTACCCACTCCCAGCTCGGAGGTAGT
GACGAAAAATAACAATACAGGACTCTCGAGGCCCTGTAATGGAATGAGTACACTTAAATCCTTTAACAAGGACCAATTGGAGGGCAAGTCTGGTGCCAGC
AGCCGCGGTAATTCCAGCTCCAATAGCGTATATTAAAGTTGTTGCGGTTAAAACGTTCGTAGTTGAACTTGGCTTCATACGGGTAGTACATTACTTTGAA
CAAATTAGAGTGCTTAAAGCAGGCGCTGAATATCGTGCATGGGATAATGAAATAAGACCTCTAGAAGCATTGGGGGCATTAGTATTACGACGCGAGAGGT
GAAATTCTTGGACCGTCGTAAGACTAACTTAAGCGAAAATTTGCCAAAGATGTTTTCATTAATCAAGAACGAAAGTTAGAGGTTCGAGGCGATCAGATAC
CGCCCTAGTTCTAACCATAAACGATGCCAGCTAGCAATTGGGTGTAGCTACTTATGGCTCTCTCAGTCGC
>Flea
TGGCTCATTATATCATTATGGTTCATTAGATCGTTGGATAACTGTGGTAATTCTAGAGCTAATACATGCAAAGTTCCGACCAGATGGAAGAATGCTTTTA
TTAGTCAAACCAATCGACCGGCGACGCATCTTTCAAATGTCTGCCTTATCAACTGTCGATGGTAGTTTCTGCGACTACCATGGTTGTTACGGGTAACGGG
GAATCAGGGTTCGATTCCGGAGAGGGAGCCTGAGAAACGGCTACCACATCCAAGGAAGGCAGCAGGCGCGCAAATTACCCACTCCCGGCACGGAGGTAGT
GACGAAAAATAACGATACGGGACTCTCGAGGCCCCGTAATGGAATGAGTACACTTAAATCCTTTAACGAGGATCCATTGGAGGGCAAGTCTGGTGCCAGC
AGCCGCGGTAATTCCAGCTCCAATAGCGTATATTAAAGTTGTTGCGGTTAAAAAGCTCGTAGTTGAATCTGGTCCCACACTGTCGGTTCTTTACTTTGAA
CAAATTAGAGTGCTTAAAGCAGGCGCTGAATATGGTGCATGGAATAATGGAATAGGACCTCGAGGGACACCGGGGGCATTCGTATTGCGACGTTAGAGGT
GAAATTCTTGGATCGTCGCAAGACGGACAGAAGCGAAAATTTGCCAAATGTGTTTTCATCAATCAAGAACGAAAGTTAGAGGCTCGAGGCGATCAGATAC
CGCCCTAGTTCTAACCATAAACGATGCCAGCTAGCGATCCGCCGAAGTTCCTCATGACTCGGCGGGCAGC
>Scorpionfl
TGGCTCATTACATCATTATGGTTCCTTAGATCGTTGGATAACTGTGGTAATTCTAGAGCTAATACATGCAAAATTCCAACCAGATGGGCGAATGCTTTTA
TTAGTCAAACCAATCGACCGGCGACGCATCTTTCAAATGTCTGCCTTATCAACTGTCGATGGTAGTTTCTGCGACTACCATGGTTGTTACGGGTAACGGG
GAATCAGGGTTCGATTCCGGAGAGGGAGCCTGAGAAACGGCTACCACATCCAAGGAAGGCAGCAGGCGCGCAAATTACCCACTCCCGGCACGGAGGTAGT
GACGAAAAATAACGATACGGGACTCTCGAGGCCCCGTAATGGAATGAGTACACTTAAATCCTTTAACGAGGATCAATTGGAGGGCAAGTCTGGTGCCAGC
AGCCGCGGTAATTCCAGCTCCAATAGCGTATATTAAAGTTGTTGCGGTTAAAAAGCTCGTAGTTGAATTTGGTTCCACACTGTTGGTTCTTTACTTTGAA
CAAATTAGAGTGCTTAAAGCAGGCGCTGAATATAGTGCATGGAATAATAGAATAGGACCTCGAGGGACACTGGGGGCATTCGTATTGCGACGTTAGAGGT
GAAATTCTTGGATCGTCGCAAGACGGACAGAAGCGAAAATTTGCCAAATGTGTTTTCATCAATCAAGAACGAAAGTTAGAGGTTCGAGGCGATCAGATAC
CGCCCTAGTTCTAACCATAAACGATGCCAGCTAGCGATCCGCCGAAGTTCCTCATGACTCGGCGGGCAGC
>Lacewing
AGGCTCATTATATCATTATGGTTCCTTAGATCGTTGGATAACTGTGGTAATTCTAGAGCTAATACATGCAAAGTTCCGACCAGATGGAAGAATGCTTTTA
TTAGTCAAACCAATCGACCGGCGACGCATCTTTCAAATGTCTGCCTTATCAACTGTCGATGGTAGGTTCTGCGCCTACCATGGTTGTAACGGGTAACGGG
GAATCAGGGTTCGATTCCGGAGAGGGAGCCTGAGAAACGGCTACCACATCCAAGGAAGGCAGCAGGCGCGCAAATTACCCACTCCCGGCACGGAGGTAGT
GACGAAAAATAACGATACGGGACTCTCGAGGCCCCGTAATGGAATGAGTACACTTAAATCCTTTAACGAGGATCCATTGGAGGGCAAGTCTGGTGCCAGC
AGCCGCGGTAATTCCAGCTCCAATAGCGTATATTAAAGTTGTTGCGGTTAAAAAGCTCGTAGTCGAATCTGGTCCTACACTGTTGGTTCTTTACTTTGAA
CAAATTAGAGTGCTTAAGGCAGGCGCTGAATATGGTGCATGGAATAATGGAATAGGACCTCGACGGACAATGGGGGCATTCGTATTGCGACGTTAGAGGT
GAAATTCTTGGATCGTCGCAAGACGGACAGAAGCGAAAATTTGCCAAAAATGTTTTGATTGATCAAGAACGAAAGTTAGAGGTTCGAGGCGATCAGATAC
CGCCCTAGTTCTAACCATAAACGATGCCAGCTAGCGATCCGCCGAAGTTCCTCATGACTCGGCGGGCAGC
>Antlion
AGGCTCATTATATCATTATGGTTCCTTAGATCGTTGGATAACTGTGGTAATTCTAGAGCTAATACATGCAAAGTTCCGACCAGATGGAAGAATGCTTTTA
TTAGTCAAACCAATCGACCGGCGACGTATCTTTCAAATGTCTGCCTTATCAACTGTCGATGGTAGGTTCTGCGCCTACCATGGTTGTAACGGGTAACGGG
GAATCAGGGTTCGATTCCGGAGAGGGAGCCTGAGAAACGGCTACCACATCCAAGGAAGGCAGCAGGCGCGCAAATTACCCACTCCCGGCACGGAGGTAGT
GACGAAAAATAACGATACGGGACTCTCGAGGCCCCGTAATGGAATGAGTACACTTAAATCCTTTAACGAGGATCCATTGGAGGGCAAGTCTGGTGCCAGC
AGCCGCGGTAATTCCAGCTCCAATAGCGTATATTAAAGTTGTTGCGGTTAAAAAGCTCGTAGTCGAATTTGGTCCTACACTGTCGGTTCTTTACTTTGAA
CAAATTAGAGTGCTTAAAGCAGGCGCTGAATATGGTGCATGGAATAATGGAATAGGACCTCGACGGACAATGGGGGCATTCGTATTGCGACGTTAGAGGT
GAAATTCTTGGATCGTCGCAAGACGGACAGAAGCGAAAATTTGCCAAAAATGTTTTGATTGATCAAGAACGAAAGTTAGAGGTTCGAGGCGATCAGATAC
CGCCCTAGTTCTAACCATAAACGATGCCAGCTAGCGATCCGCCAAAGTTCCTCATGACTTGGTGGGCAGC
>Sawfly
TGGCTCATTAAATCATTATGGTTCCTTAGATCGTTGGATAACTGTGGTAATTCTAGAGCTAATACATGCAAAGTTCCGACCAAATGGGAGAATGCTTTTA
TTAGTCAAACCAATCGACCGGCGACGCATCTTTCAAATGTCTGCCTTATCAACTGTCGATGGTAGGTTCTGCGCCTACCATGGTTGTAACGGGTAACGGG
GAATCAGGGTTCGATTCCGGAGAGGGAGCCTGAGAAACGGCTACCACATCCAAGGAAGGCAGCAGGCGCGCAAATTACCCACTCCCGGCACGGAGGTAGT
GACGAAAAATAACGATACGGGACTCTCGAGGCCCCGTAATGGAATGAGTACACTTAAATCCTTTAACGAGGATCCATTGGAGGGCAAGTCTGGTGCCAGC
AGCCGCGGTAATTCCAGCTCCAATAGCGTATATTAAAGTTGTTGCGGTTAAAAAGCTCGTAGTTGAATCTGGTCCCACGCTGCCGGTTCTTTACTTTGAA
CAAATTAGAGTGCTTAAAGCAGGCGCTGAATATGGTGCATGGAATAATGGAATAGGACCTCGAGGGACAATGGGGGCATTCGTATTGCGACGTTAGAGGT
GAAATTCTTGGATCGTCGCAAGACGGACAGAAGCGAAAATTTGCCAAAAATGTTTTCTTTAATCAAGAACGAAAGTTAGAGGTTCGAGGCGATCAGATAC
CGCCCTAGTTCTAACCATAAACGATGCCAGCTAGCGATCCGCCGAAGTTCCTCATGACTCGGCGGGCAGC
>Meloe
AGGCTCATTAAATCATTATGGTTCCTTAGATCGTTGGATAACTGTGGTAATTCTAGAGCTAATACATGCAAAACTCCAACCAGACGGAAGAGTGCTTTTA
TTAGTCAAATCAATCGACCGGCGACGCATCTTTCAAATGTCTGCCTTATCAACTGTCGATGGTAGGTTTTGCGCCTACCATGGTTGTAACGGGTAACGGG
GAATCAGGGTTCGATTCCGGAGAGGGAGCCTGAGAAACGGCTACCACATCCAAGGAAGGCAGCAGGCGCGCAAATTACCCACTCCCGGCACGGAGGTAGT
GACGAAAAATAACGATACGGGACTCTCGAGGCCCCGTAATGGAATGAGTACACTTAAATCCTTTAGCAAGGATCAATTGGAGGGCAAGTCTGGTGCCAGC
AGCCGCGGTAATTCCAGCTCCAATAGCGTATATTAAAGTTGTTGCGGTTAAAAAGCTCGTAGTCGAATTTGGTCTCATGCCGCTGGTTCTTTACTTTGAA
CAAATTAAAGTGCTTAAAGCAGGCGCTGAATATGGTGCATGGAATAATGGAATAGGACCTCGAGGAACGATGGGGGCATTCGTATTGCGACGTTAGAGGT
GAAATTCTTGGATCGTCGCAAGACGAACATAAGCGAAAATTTGCCAAAAACGTTTTCATTGATCAAGAACGAAAGTTAGAGGTTCGAGGCGATCAGATAC
CGCCCTAGTTCTAACCATAAACGATGCCAGCCAGCGATCCGCCGATGTTCCTCATGACTCGGCGGGGAGC
>Polistes
TGGCTCATTAAATCATTATGGTTTCTTAGATCGTTGGATAACTGTGGTAATTCTAGAGCTAATACATGCAAAGTTCCAACCAGATGGGAGAACGCTTTTA
TTAGTCAAACCAATCGACCGGCGACAAATCTTTCAAATGTCTGCCTTATCAACTGTCGATGGTAGGTTCTGCGCCTACCATGGTTGTAACGGGTAACGGG
GAATCAGGGTTCGATTCCGGAGAGGGAGCCTGAGAAACGGCTACCACATCCAAGGAAGGCAGCAGGCGCGCAAATTACCCACTCCCGGCACGGAGGTAGT
GACGAAAAATAACGATACGGGACTCTCGAGGCCCCGTAATGGAATGAGTACACTTAAATCCTTTAACAAGGATCCATTGGAGGGCAAGTCTGGTGCCAGC
AGCCGCGGTAATTCCAGCTCCAATAGCGTATATTAAAGTTGTTGCGGTTAAAAAGCTCGTAGTTGAATCTGGTTTCACACTGTTGGTTCTTTACTTTGAA
CAAATTAGAGTGCTTAAAGCAGGCGCTGAATATGGTGCATGGAATAATGGAATAGGACCTCGAGGGACAATGGGGGCATTCGTATTGCGACGTTAGAGGT
GAAATTCTTGGATCGTCGCAAGACGGACAGAAGCGAAAATTTGCCAAAAATGTTTTCATTAATCAAGAACGAAAGTTAGAGGTTCGAGGCGATCAGATAC
CGCCCTAGTTCTAACCATAAACGATGCCAGCTAGCGATCCGCCGAAGTTCCTCATGACTCGACGGGCAGC
>Tenebrio
AGGCTCATTAAATCATTATGGTTCCTTAGATCGTTGGATAACTGTGGTAATTCTAGAGCTAATACATGCAAAGCTCCAACCAAACGGAAGAGCGCTTTTA
TTAGTCAAACCAATCGACCGGCGACGCATCTTTCAAATGTCTGCCTTATCAACTGTCGATGGTAGGTTCTGCGCCTACCATGGTTGTAACGGGTAACGGG
GAATCAGGGTTCGATTCCGGAGAGGGAGCCTGAGAAACGGCTACCACATCCAAGGAAGGCAGCAGGCGCGCAAATTACCCACTCCCGGCACGGAGGTAGT
GACGAAAAATAACGATACGGGACTCTCGAGGCCCCGTAATGGAATGAGTACACCTAAACCCTTTAACGAGGATCAATTGGAGGGCAAGTCTGGTGCCAGC
AGCCGCGGTAATTCCAGCTCCAATAGCGTATATTAAAGTTGTTGCGGTTAAAAAGCTCGTAGTCGAATCTGGTCCCGCGCCGCCGGTTCTTTACTTTGAA
CAAATTAGAGTGCTTAAAGCAGGCGCTGAATATGGTGCATGGAATAATGGAATAGGACCTCGAGGAACGATGGGGGCATTCGTATTGCGACGTTAGAGGT
GAAATTCTTGGATCGTCGCAAGACGGACAGAAGCGAAAATTTGCCAAAAACGCTTTCATTGATCAAGAACGAAAGTTAGAGGTTCGAGGCGATCAGATAC
CGCCCTAGTTCTAACCATAAACGATGCCAGCTAGCGATCCGCCGACGTTCCTCATGACTCGGCGGGCAGC
>OUU06478
AGGCTCATTAAATCATTATGGTTCCTTGGATCTTTGGATAACTGTGGTAATTCTAGAGCTAATACATGCAAAGTCCCGACCAGATGGAAGGACGCTTTTA
TTAGTCAAACCGATCGACCGGCGACGCATCTTTCAAATGTCTGACTTATCAACTGTCGATGGTAGGCTCTGCGCCTACCATGGTTGTAACGGGTAACGGG
GAATCAGGGTTCGATTCCGGAGAGGGAGCCTGAGAAACGGCTACCACATCCAAGGAAGGCAGCAGGCGCGCAAATTACCCACTCCCGGCACGGAGGTAGT
GACGAAAAATAACGATACGGGACTCTCGAGGCCCCGTAATGGAATGAGTACACTTAAATACTTTAACGAGTACCAATTGGAGGGCAAGTCTGGTGCCAGC
AGCCGCGGTAATTCCAGCTCCAATAGCGTATATTAAAGTTGTTGCGGTTAAAAAGCTCGTAGTTGGATCTGGTGCCACGCTGTCGGTTCTTTACTTTGAA
CAAATTAGAGTGCTCAAATCAGGTGCTGAATATGGTGCATGGAATAATGGAATAGGACCTCGAGGGACAGCGGGGGCATTCGTATTGCGACGTTAGAGGT
GAAATTCTTGGATCGTCGCAAGACGAACCTAAGCGAAAATTTGCCAAGTATGTTCCCGTTAATCAAGAACGAAAGTTAGAGGTTCGAGGCGATCAGATAC
CGCCCTAGTTCTAACCATAAACGATGCCAGCCAGCGATCCGCCGAAGTTCCTCATGACTCGGCGGGCAGC
>PSU06480
AGGCTCATTAAATCATTATGGTTCCTTAGATCGTTGGATAACTGTGGTAATTCTAGAGCTAATACATGCAAAGTCCCGACCAGATGGAAGGACGCTTTTA
TTAGTCAAACCAATCGACCGGCGACGCATCTTTCAAATGTCTGACTTATCAACTGTCGATGGTAGATTCTGCGCCTACCATGGTTGTAACGGGTAACGGG
GAATCAGGGTTCGATTCCGGAGAGGGAGCCTGAGAAACGGCTACCACATCCAAGGAAGGCAGCAGGCACGCAAATTACCCACTCCCGGCACGGAGGTAGT
GACGAAAAATAACGATACGGGACTCTCGAGGCCCCGTAATGGAATGAGTACACTTAAATCCTTTAACGAGTACCAATTGGAGGGCAAGTCTTGTGCCAGC
AGCCGCGGTAATTCCAGCTCCAATAGCGTATATTAAAGTTGTTGCGGTTAAAAAGCTCGTAGTTGGATCTGGTTCCACGCTGTCGGTTCTTTACTTTGAA
CAAATTAGAGTGCTTAAAGCAGGCGCTGAATATGGTGCATGGAATAATGGAATAGGATCTCGAGGGACAGCGGGGGCATTCGTATTGCGACGTTAGAGGT
GAAATTCTTGGATCGTCGCAAGACGAACCTAAGCGAAAATTTGCCAAGTATGTCCTCGTTAATCAAGAACGAAAGTTAGAGGTTCGAGGCGATCAGATAC
CGCCCTAGTTCTAACCGTAAACGATGCCAGCCAGCGATCCGCCGACGTTCCTCATGACTCGGCGGGCAGC

			</textarea>
			<br />
			
			<button id="make" onclick="make();">Make tree</button>
		</div>

	<div id="matrix"></div>

	<div style="position:relative;height:250px;">
		<div id="names" style="left:0px;width:100px;position:absolute;border:1px solid rgb(244,244,244);"></div>
		<div id="seq" style="position:absolute;overflow-x:auto;width:90%;border:1px solid rgb(244,244,244);left:100px;"></div>
	</div>

<div style="clear:both"></div>

 <div style="position:relative;">
    <form>
      <label>Radial layout</label>
      <input type="checkbox" id="layout" checked/>
    </form>
 </div>
  <div style="position:relative;">
  	<div style="top:250px;left:200px;position:absolute;">
		<svg id="tree_display"  style="" ></svg>
	</div>
  </div>

</div>


<script>

//----------------------------------------------------------------------------------------
// show distance matrix
function hits_as_dist(D)
{
	var html = '';
	
	var n = D.length;

	for (var i = 1; i < n; i++)
	{
		html += '';
		
		for (var j = 0; j < i; j++)
		{
			html += D[i][j] + ' ';
		}
		
		html += '<br />';
	}
	
	$('#matrix').html(html);

}
</script>

<script>



//----------------------------------------------------------------------------------------
// parse data
function parse_data(data) {
	var sequences = [];

	var lines = data.split(/\n/);

	console.log(JSON.stringify(lines, null, 2));

	var state = 0;

	var name = '';
	var count = 0;
	var n = 0;

	while (count < lines.length) {
	   switch (state)
	   {
		case 0:
		  if (lines[count].match(/^>(.*)/)) {
			var seq = {};
			seq.name = lines[count].replace(/^>/, '');
			
			var m = seq.name.match(/([A-Z]+\d+)/);
			if (m) {
				seq.name = m[1];
			}
			seq.seq = '';
			sequences.push(seq);
			n++;
			state = 1;
		  }
		  count++;
		  break;
	  
		case 1:
		  if (!lines[count].match(/^\w+/)) {
			state = 0;
		  } else {
			  sequences[n-1].seq += lines[count].toUpperCase();
			  count++;
		  }
		  break;
	  
		 default:
			break;
		
		}
	}
	console.log(JSON.stringify(sequences, null, 2));

	return sequences;
}

//----------------------------------------------------------------------------------------
function compute_tuple_distances (sequences) {
	var n = sequences.length;

 // compute pairwise distance
	var cp = 
		cartesianProduct(
			[
				['A','C','G','T'], 
				['A','C','G','T'], 
				['A','C','G','T'], 
				['A','C','G','T'], 
				['A','C','G','T']
			]
		);

	// encode sequences as 5-tuples
	var tuples = [];

	for (var i = 0; i < n; i++) 
	{
		tuples[i] = {};
	
		// intialise
		for (var j in cp)
		{		
			tuples[i][cp[j].join("")] = 0;
		}

		var seq = sequences[i].seq;
		var len = seq.length;
	
		for (var j = 0; j < len - 5; j++)
		{
			var tuple = seq.substring(j, j + 5);
			//document.write(tuple + '<br/>');
		
			if (tuple in tuples[i]) {
				tuples[i][tuple]++;
			}
		}
	}


	// compute distances
	var D = [];
	for (var i = 0; i < n; i++) {
		D[i] = [];
		for (var j = 0; j < n; j++) {
			D[i][j] = 0;
		}
	}

	
	// tuples
	for (var i = 1; i < n; i++) {
		for (var j = 0; j < i; j++) {
			var d = 0;
			// compare tuples
			for (var k in tuples[i]) {
				d += (tuples[i][k] - tuples[j][k]) * (tuples[i][k] - tuples[j][k]);
			}

			D[i][j] = d;
			D[j][i] = d;
		}
	}
	
	return D;
}

//----------------------------------------------------------------------------------------
// // assume sequences are aligned
function compute_p_distances (sequences) {
	var n = sequences.length;
	
	// compute distances
	var D = [];
	for (var i = 0; i < n; i++) {
		D[i] = [];
		for (var j = 0; j < n; j++) {
			D[i][j] = 0;
		}
	}
	
	var length = sequences[0].seq.length;
	for (var i = 1; i < n; i++) {
		for (var j = 0; j < i; j++) {
			var d = 0;
			
			for (var k = 0; k < length; k++) {
			   if (sequences[i].seq[k] != sequences[j].seq[k]) {
			     d += 1;
			    }
			}
			console.log("d=" + d + ", length =" + length);
			
			d = d/length;
			
			
		
			D[i][j] = d;
			D[j][i] = d;
		}
	}
	
	return D;
}	
	
//----------------------------------------------------------------------------------------
// labels for sequences
function get_otu_labels(sequences) {
	var n = sequences.length;
	
	var taxa = [];

	for (var i = 0; i < n; i++) {
		taxa.push({name:sequences[i].name});
	}
	
	return taxa;
}



//----------------------------------------------------------------------------------------

function make()
{
	var data  =  $('#data').val();
	
	//alert(data);
	
	var sequences = parse_data(data);


	// show sequences
	if (1) {
		var html = '';
		var k = sequences[0].seq.length;
		for (var i = 0; i < sequences.length; i++) {
			html += '<div style="margin:0px;padding:0px;line-height:1.4em;font-size:10px;font-family:monospace;white-space: nowrap;">';
			for (var j = 0; j < k; j++) {
				var base_class = sequences[i].seq.charAt(j);
				if (base_class == '-') {
					base_class='gap';
				}
			
				html += '<span class="' + base_class + '">' + sequences[i].seq.charAt(j) + '</span>';
			}
			html += '</div>';
		}
		html += '<div style="margin:0px;padding:0px;line-height:0.9em;">&nbsp;</div>';
		$("#seq").html(html);

		// show labels
		html = '';
		for (var i = 0; i < sequences.length; i++) {
			html += '<div style="margin:0px;padding:0px;line-height:1.4em;font-size:10px;font-family:monospace;">';
	
			html += sequences[i].name;
	
			html += '</div>';
		}
		html += '<div style="margin:0px;padding:0px;line-height:0.9em;">&nbsp;</div>';
		$("#names").html(html);
	}




	var D = null;
	if (0) {
		D = compute_p_distances(sequences);
	} else {
		D = compute_tuple_distances(sequences);	
	}

	var taxa = get_otu_labels(sequences);
	
		//hits_as_dist(D);

	// build tree


		var RNJ = new RapidNeighborJoining(D, taxa);
		RNJ.run();
		console.log('run');
		var treeObject = RNJ.getAsObject();
		var treeNewick = RNJ.getAsNewick();
		console.log(treeNewick);
		
		treeNewick = treeNewick.replace(/East107:0.0,East108:0.0/, 'East107,East108');
	

	// show

	//treeNewick = '(((EELA:0.150276,CONGERA:0.213019):0.230956,(EELB:0.263487,CONGERB:0.202633):0.246917):0.094785,((CAVEFISH:0.451027,(GOLDFISH:0.340495,ZEBRAFISH:0.390163):0.220565):0.067778,((((((NSAM:0.008113,NARG:0.014065):0.052991,SPUN:0.061003,(SMIC:0.027806,SDIA:0.015298,SXAN:0.046873):0.046977):0.009822,(NAUR:0.081298,(SSPI:0.023876,STIE:0.013652):0.058179):0.091775):0.073346,(MVIO:0.012271,MBER:0.039798):0.178835):0.147992,((BFNKILLIFISH:0.317455,(ONIL:0.029217,XCAU:0.084388):0.201166):0.055908,THORNYHEAD:0.252481):0.061905):0.157214,LAMPFISH:0.717196,((SCABBARDA:0.189684,SCABBARDB:0.362015):0.282263,((VIPERFISH:0.318217,BLACKDRAGON:0.109912):0.123642,LOOSEJAW:0.3971):0.287152):0.140663):0.206729):0.222485,(COELACANTH:0.558103,((CLAWEDFROG:0.441842,SALAMANDER:0.299607):0.135307,((CHAMELEON:0.771665,((PIGEON:0.150909,CHICKEN:0.172733):0.082163,ZEBRAFINCH:0.099172):0.272338):0.014055,((BOVINE:0.167569,DOLPHIN:0.15745):0.104783,ELEPHANT:0.166557):0.367205):0.050892):0.114731):0.295021)';

	

	var tree = d3.layout.phylotree()
			.svg(d3.select("#tree_display"))
			.radial(true);

		  tree(d3.layout.newick_parser(treeNewick))
			.layout();

		  $("#layout").on("click", function(e) {
			tree.radial($(this).prop("checked")).placenodes().update();
		  });


	//$("#tree_display").css('transform-origin', '50% 50%');
	//$("#tree_display").css('translate', '(100, 100)');
	$("#tree_display").css('transform', 'scale(1.5)');
}



</script>





</body>
</html>
